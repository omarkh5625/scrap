# ุญู ูุดููุฉ: Call to undefined method Router::startJobProcessing()

## ๐ด ุงููุดููุฉ
```
Fatal error: Uncaught Error: Call to undefined method Router::startJobProcessing() 
in /home/send/public_html/serp/serp/app.php:2557
```

## โ ุงูุญู

ุงููุดููุฉ ุฃู ุงูููู `app.php` ุนูู ุงูุณูุฑูุฑ ูุญุชูู ุนูู ูุณุฎุฉ ูุฏููุฉ ุชุณุชุฏุนู ุฏุงูุฉ ุบูุฑ ููุฌูุฏุฉ.

### ุงูุฎุทูุงุช:
1. **ุญููู ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ ูู app.php**
   - ุงููุณุฎุฉ ุงูุญุงููุฉ ูู ูุฐุง ุงูุฑูุจู ุตุญูุญุฉ ูููุตูุญุฉ
   - ุงุณุชุจุฏู ุงูููู ุงููุฏูู ุจุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ ูุงููุฉ

2. **ุชุฃูุฏ ูู ุฃู ุงูููุฏ ูุณุชุฎุฏู ุงูุฏุงูุฉ ุงูุตุญูุญุฉ:**
   ```php
   // โ ุงูููุฏ ุงูุตุญูุญ (ููุฌูุฏ ูู ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ):
   self::spawnParallelWorkers($jobId, $workerCount);
   
   // โ ุงูููุฏ ุงูุฎุทุฃ (ููุฌูุฏ ูู ุงููุณุฎุฉ ุงููุฏููุฉ):
   self::startJobProcessing($jobId, $workerCount);
   ```

## ๐ ุงูุฏูุงู ุงููููุฉ ูู ุงููุธุงู ุงูุฌุฏูุฏ

### 1. spawnParallelWorkers() - ุชุดุบูู ุงูุนูุงู
```php
private static function spawnParallelWorkers(int $jobId, int $workerCount): void
```
- **ุงููููุน:** ุงูุณุทุฑ 2947
- **ุงููุธููุฉ:** ุฅูุดุงุก queue items ูุชุดุบูู ุงูุนูุงู ุงููุญุฏุฏุฉ
- **ุงูุงุณุชุฏุนุงุก:** ูู Dashboard ุนูุฏ ุฅูุดุงุก job ุฌุฏูุฏ

### 2. spawnWorkersDirectly() - ุชูููุฐ ุงูุนูุงู
```php
private static function spawnWorkersDirectly(int $jobId, int $workerCount): int
```
- **ุงููููุน:** ุงูุณุทุฑ 2997
- **ุงููุธููุฉ:** ุชูููุฐ ุงูุนูุงู inline (ุจุฏูู HTTP loopback)
- **ุงูุงุณุชุฏุนุงุก:** ูู spawnParallelWorkers()

## ๐ฏ ุงูููุทู ุงูููุญุฏ (ุจุฏูู ุตูุญุฉ Workers)

### ุงูุชุฏูู ุงูุฌุฏูุฏ:
```
Dashboard โ ุฅูุดุงุก Job โ ุชุญุฏูุฏ ุนุฏุฏ Workers โ spawnParallelWorkers()
                                                           โ
                                            ุฅูุดุงุก Queue Items + ุชุดุบูู Workers
                                                           โ
                                                  ูุนุงูุฌุฉ ูุชูุงุฒูุฉ
```

### ุงูููุฒุงุช:
โ **ุตูุญุฉ ูุงุญุฏุฉ ููุท (Dashboard)** - ูุง ุญุงุฌุฉ ูุตูุญุฉ Workers  
โ **ุชุญุฏูุฏ ุนุฏุฏ Workers ุฅูุฒุงูู** - ูุง ูููู ุงูุจุฏุก ุจุฏูู ุชุญุฏูุฏ ุงูุนุฏุฏ  
โ **ูุนุงูุฌุฉ ูุชูุงุฒูุฉ ุชููุงุฆูุฉ** - ูู worker ูุนุงูุฌ ุฌุฒุก ูู Job  
โ **ุฅุญุตุงุฆูุงุช ููุฑูุฉ** - ุนุฑุถ ุญุงูุฉ Workers ูู Dashboard  

## ๐ง ูููุงุช ูููุฉ

### app.php
ุงูููู ุงูุฑุฆูุณู ุงูุฐู ูุญุชูู ุนูู ูู ุงูููุฏ:
- **ุงูุณุทุฑ 2538-2567**: ููุทู ุฅูุดุงุก Job ูู Dashboard
- **ุงูุณุทุฑ 2564**: ุงุณุชุฏุนุงุก spawnParallelWorkers (ุงูุตุญูุญ)
- **ุงูุณุทุฑ 2947**: ุชุนุฑูู ุฏุงูุฉ spawnParallelWorkers
- **ุงูุณุทุฑ 2997**: ุชุนุฑูู ุฏุงูุฉ spawnWorkersDirectly

### ุงูุฏูุงู ุงููุญุฐููุฉ (ุบูุฑ ููุฌูุฏุฉ):
- โ `startJobProcessing()` - ูุญุฐููุฉ (ูุงูุช redundant)
- โ `renderWorkers()` - ูุญุฐููุฉ (ุงูุตูุญุฉ ูุงููุฉ)
- โ `renderNewJob()` - ูุญุฐููุฉ (ูุฏูุฌุฉ ูู Dashboard)

## ๐ ุฎุทูุงุช ุงูุชุญุฏูุซ ุนูู ุงูุณูุฑูุฑ

### 1. ุนูู Backup
```bash
cp app.php app.php.backup
```

### 2. ุฑูุน ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ
- ุญููู `app.php` ูู ุงูุฑูุจู
- ุงุณุชุจุฏู ุงูููู ุงููุฏูู ุจุงูุฌุฏูุฏ

### 3. ูุณุญ ุงูู Cache (ุฅู ููุฌุฏ)
```bash
# ุฅุฐุง ูุงู ูุฏูู OPcache
php -r "opcache_reset();"

# ุฃู ุฃุนุฏ ุชุดุบูู PHP-FPM
service php-fpm restart
```

### 4. ุงุฎุชุจุฑ ุงููุธุงู
1. ุงูุชุญ Dashboard
2. ุฃูุดุฆ job ุฌุฏูุฏ
3. ุญุฏุฏ ุนุฏุฏ workers (ูุซูุงู 20)
4. ุงุถุบุท "Start Extraction"
5. ุชุญูู ูู ุชุดุบูู Workers ูู ุงูู logs

## ๐ ุงููุฑู ุจูู ุงููุณุฎุฉ ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ

| ุงูููุฒุฉ | ุงููุณุฎุฉ ุงููุฏููุฉ | ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ |
|--------|----------------|----------------|
| ุนุฏุฏ ุงูุตูุญุงุช | 3 (Dashboard, Workers, New Job) | 1 (Dashboard ููุท) |
| ุชุดุบูู Workers | ูุฏูู ูู ุตูุญุฉ Workers | ุชููุงุฆู ูู Dashboard |
| ุนุฏุฏ Workers | ุงุฎุชูุงุฑู | ุฅูุฒุงูู (ูุง ูููู ุงูุจุฏุก ุจุฏููู) |
| ุงูุฏูุงู | startJobProcessing() | spawnParallelWorkers() |
| ุงููุนุงูุฌุฉ | ุชุณูุณููุฉ ุฃุญูุงูุงู | ูุชูุงุฒูุฉ ุฏุงุฆูุงู |

## ๐ ุงูุฃุฏุงุก

### ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ ุฃุณุฑุน:
- **Rate limit**: 0.3s โ 0.1s (3x ุฃุณุฑุน)
- **Parallel connections**: 50 โ 100 (2x ุณุนุฉ)
- **Host connections**: 10 โ 20 (2x ุชูุงุฒู)

### ุงููุฏู ุงููุชููุน:
- 100,000 ุฅูููู ูู ~3-5 ุฏูุงุฆู ูุน 20-50 worker

## โ ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ

### ุณ: ูู ุฃุญุชุงุฌ ูุชุบููุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุชุ
ุฌ: ูุงุ ุงููุงุนุฏุฉ ููุง ูู. ุงููุธุงู ูุนูู automatic migrations.

### ุณ: ูู ุณุชุนูู Jobs ุงููุฏููุฉุ
ุฌ: ูุนูุ Jobs ุงููุฏููุฉ ุณุชุนูู ุจุฏูู ูุดุงูู.

### ุณ: ููู ุฃุนุฑู ุฃู ุงูุชุญุฏูุซ ูุฌุญุ
ุฌ: ุงูุชุญ Dashboard - ุฅุฐุง ุฑุฃูุช ูููุฐุฌ ุฅูุดุงุก Job ูุจุงุดุฑุฉุ ุงูุชุญุฏูุซ ูุฌุญ.

### ุณ: ูุงุฐุง ูู ุงุณุชูุฑุช ุงููุดููุฉุ
ุฌ: ุชุฃูุฏ ูู:
1. ุงูููู ูุญุฏูุซ ุจุงููุงูู (ุชุญูู ูู ุฑูู ุงูุณุทุฑ 2564)
2. ูุง ููุฌุฏ cache ููู PHP
3. ุตูุงุญูุงุช ุงูููู ุตุญูุญุฉ (644)

## ๐ ุงูุฏุนู

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ ุจุนุฏ ุงูุชุญุฏูุซ:
1. ุชุญูู ูู php_errors.log
2. ุชุฃูุฏ ูู ุฃู app.php ูุญุชูู ุนูู ุงูุฏุงูุฉ spawnParallelWorkers
3. ุงุจุญุซ ูู ุงูููุฏ ุนู "startJobProcessing" - ูุฌุจ ุฃูุง ุชุฌุฏูุง

## โ ุงูุชุญูู ุงูููุงุฆู

ุจุนุฏ ุงูุชุญุฏูุซุ ูุฌุจ ุฃู ุชุฌุฏ:
```bash
# ุงุจุญุซ ุนู ุงูุฏุงูุฉ ุงูุตุญูุญุฉ
grep -n "spawnParallelWorkers" app.php
# ูุฌุจ ุฃู ุชุธูุฑ ูู 3 ููุงูุน ุชูุฑูุจุงู

# ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุงูุฏุงูุฉ ุงููุฏููุฉ
grep -n "startJobProcessing" app.php
# ูุฌุจ ุฃูุง ุชุธูุฑ ุฃู ูุชุงุฆุฌ (ุฃู ููุท ูู ุงูุชุนูููุงุช)
```

---

## ๐ ููุฎุต ุงูุญู

**ุงููุดููุฉ:** ุงููุณุฎุฉ ุงููุฏููุฉ ุนูู ุงูุณูุฑูุฑ  
**ุงูุญู:** ุชุญุฏูุซ app.php ุจุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ ูู ุงูุฑูุจู  
**ุงููุชูุฌุฉ:** ููุทู ููุญุฏ ุจุฏูู ุตูุญุฉ Workersุ ุนูุงู ูุชูุงุฒูุฉ ูู Dashboard  
